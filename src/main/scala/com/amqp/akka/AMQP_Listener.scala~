package com.amqp.akka

import akka.actor.Actor
import com.rabbitmq.client.{QueueingConsumer, Channel}

//AMQP listener is an actor used to consume the messages from sender
class AMQP_Listener(channel:Channel,queue:String) extends Actor{
  override def preStart = self ! "init"

  def receive = {
    case _ => startReceiving
  }

  def startReceiving = {
    val consumer:QueueingConsumer = new QueueingConsumer(channel)
    channel.basicConsume(queue, true, consumer)
    while (true) {
      val delivery:QueueingConsumer.Delivery = consumer.nextDelivery()
      val msg:String = new String(delivery.getBody)
      Thread.sleep(1000)
      println(sender().path + " got " + msg)
    }
  }
}
